# Notion标题自动序号插件调试指南

## 调试方法概述

为了解决插件在Notion页面中出现的性能问题和错误，我们需要收集更详细的运行信息。本文档说明如何使用调试版的content.js来收集这些信息。

## 调试版插件的使用方法

### 1. 替换文件

1. 打开已安装的插件文件夹
2. 将原始的`content.js`文件备份为`content.js.bak`
3. 将`debug-content.js`文件复制到插件目录并重命名为`content.js`

### 2. 重新加载插件

1. 打开Chrome浏览器，访问`chrome://extensions/`
2. 找到"Notion自动标题序号"插件
3. 点击插件卡片右下角的刷新图标重新加载插件

### 3. 收集日志信息

1. 打开任意Notion页面
2. 右键点击页面，选择"检查"或按F12打开开发者工具
3. 切换到"控制台"(Console)标签页
4. 清空现有日志(按Ctrl+L或点击控制台左上角的清除图标)
5. 尝试使用插件功能，观察控制台输出的日志：
   - 点击插件图标启用自动序号
   - 手动应用或移除序号
   - 在Notion页面中编辑内容

### 4. 保存日志信息

1. 在控制台中右键点击，选择"保存为..."，将完整日志保存为文件
2. 或复制关键日志信息

## 调试版content.js的关键功能

调试版content.js添加了以下调试功能：

1. **详细日志记录**：
   - 所有关键操作都添加了日志输出
   - 使用不同的日志级别(info, warning, error)
   - 记录操作耗时和频率

2. **DOM结构分析**：
   - 自动分析Notion页面结构
   - 识别可能的标题元素
   - 记录选择器匹配结果

3. **性能监控**：
   - 记录MutationObserver触发频率
   - 监控操作执行时间
   - 标记潜在的性能瓶颈

4. **错误诊断**：
   - 更详细的错误信息
   - 记录操作上下文
   - 提供错误发生时的状态信息

## 日志分析指南

收集到日志后，重点关注以下几个方面：

1. **选择器匹配问题**：
   - 查找"测试选择器组"相关日志
   - 检查每个选择器找到的元素数量
   - 识别哪些选择器无法匹配

2. **MutationObserver行为**：
   - 观察MutationObserver触发频率
   - 检查是否存在短时间内的高频触发
   - 确认变更是否与标题相关

3. **标题元素识别**：
   - 查看"找到的标题元素"相关日志
   - 确认标题元素是否被正确识别和分类
   - 检查标题级别判断是否准确

4. **性能问题**：
   - 关注执行时间较长的操作
   - 检查是否存在重复或不必要的操作
   - 查找可能的无限循环或递归调用

5. **错误信息**：
   - 查找带有"错误"或"失败"字样的日志
   - 分析错误上下文和原因
   - 确定错误是否影响功能或性能

## 恢复正常版本

完成调试后：

1. 删除或重命名修改后的`content.js`文件
2. 将备份的`content.js.bak`文件恢复为`content.js`
3. 重新加载插件

## 常见问题及解决方法

1. **日志过多导致控制台卡顿**：
   - 在调试前清空控制台
   - 设置过滤器只显示带有"[Notion标题序号插件]"前缀的日志
   - 在长时间操作前暂时关闭控制台

2. **插件完全无法工作**：
   - 检查控制台是否有语法错误
   - 确认插件已正确重新加载
   - 检查权限是否正确

3. **无法保存完整日志**：
   - 设置控制台保留日志选项
   - 分段记录日志
   - 使用浏览器扩展捕获控制台输出 